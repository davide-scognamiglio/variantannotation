#!/usr/bin/env bash
# bin/generate_setup_report.sh
# Generates a modern HTML report for downloaded databases
# Usage: generate_setup_report.sh <output_html> <folder1> <folder2> ...

OUTPUT_HTML=$1
shift
DOWNLOAD_DIRS=("$@")

cat << 'EOF' > "$OUTPUT_HTML"
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setup Report</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
<div class="max-w-4xl mx-auto py-12 px-6">
  <h1 class="text-4xl font-bold mb-6 text-center text-blue-700">Pipeline Setup Report</h1>
  <p class="text-center mb-8 text-gray-600">Summary of downloaded databases and resources.</p>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
EOF

for d in "${DOWNLOAD_DIRS[@]}"; do
    if [[ -d "$d" ]]; then
        NAME=$(basename "$d")
        FILE_COUNT=$(find "$d" -type f | wc -l)
        cat << EOF >> "$OUTPUT_HTML"
    <div class="p-4 bg-white shadow rounded border-l-4 border-blue-500">
      <h2 class="text-xl font-semibold mb-2">$NAME</h2>
      <p class="text-gray-600">Files downloaded: $FILE_COUNT</p>
      <ul class="text-gray-700 mt-2 list-disc list-inside">
EOF
        for f in "$d"/*; do
            [[ -f "$f" ]] && echo "        <li>$(basename "$f")</li>" >> "$OUTPUT_HTML"
        done
        cat << EOF >> "$OUTPUT_HTML"
      </ul>
    </div>
EOF
    fi
done

cat << 'EOF' >> "$OUTPUT_HTML"
  </div>
  <footer class="text-center text-gray-400 mt-12 text-sm">
    Generated by nf-core/variantannotation
  </footer>
</div>
</body>
</html>
EOF
